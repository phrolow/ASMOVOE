Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 1
strlen.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     locals @@
      7
      8	0100  B8 0370r		     Start:  mov ax, offset jopa
      9	0103  50			     push ax
     10
     11	0104  E8 0014			     call strlen
     12
     13	0107  80 C3 30			     add bl, '0'
     14	010A  BF 0374r			     mov di, offset outl
     15	010D  47			     inc di
     16	010E  88 1D			     mov [di], byte ptr	bl
     17
     18	0110  BE 0374r			     mov si, offset outl
     19
     20	0113  E8 001A			     call fout
     21
     22	0116  B8 4C00			     mov ax, 04C00h
     23	0119  CD 21			     int 21h
     24
     25				     include strlen.asi
1    26	011B			     strlen  proc
1    27	011B  55			     push bp
1    28	011C  8B EC			     mov bp, sp
1    29
1    30	011E  8B 46 04			     mov ax, [bp + 4]
1    31
1    32	0121  BB FFFF			     mov bx, 0FFFFh
1    33	0124  8B F0			     mov si, ax
1    34
1    35	0126  AC		     @@Next: lodsb
1    36
1    37	0127  43			     inc bx
1    38
1    39	0128  3C 24			     cmp al, '$'
1    40	012A  75 FA			     jne @@Next
1    41
1    42	012C  8B E5			     mov sp, bp
1    43	012E  5D			     pop bp
1    44	012F  C3			     ret
1    45	0130				     endp
     46
     47				     include out.asi
1    48				     ; pls si
1    49
1    50	0130			     fout    proc
1    51	0130  55			     push bp
1    52	0131  8B EC			     mov bp, sp
1    53
1    54	0133  56			     push si
1    55
1    56	0134  B4 1E			     mov ah, 1Eh
1    57
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 2
strlen.asm



1    58	0136  BF B800			     mov di, 0B800h
1    59	0139  8E C7			     mov es, di
1    60
1    61	013B  BF 0334			     mov di, (80 * 5 + 10) * 2
1    62
1    63	013E  B6 0F			     mov dh, 15
1    64	0140  B2 3C			     mov dl, 60
1    65
1    66	0142  BE 0367r			     mov si, offset frame
1    67
1    68	0145  E8 0019			     call Border
1    69
1    70	0148  5E			     pop si
1    71
1    72	0149  8A 1C			     mov bl, byte ptr [si]
1    73	014B  32 FF			     xor bh, bh
1    74
1    75	014D  46			     inc si
1    76
1    77	014E  32 E4			     xor ah, ah
1    78	0150  8A C3			     mov al, bl
1    79
1    80	0152  B2 0A			     mov dl, 10
1    81	0154  F6 F2			     div dl
1    82
1    83	0156  8A D4			     mov dl, ah
1    84	0158  8A F0			     mov dh, al
1    85
1    86	015A  E8 0068			     call Text
1    87
1    88	015D  8B E5			     mov sp, bp
1    89	015F  5D			     pop bp
1    90	0160  C3			     ret
1    91	0161				     endp
1    92
1    93				     include bordre.asi
2    94				     ;
2    95				     ; args - ah, di, dl, si
2    96				     ; ah - attribute
2    97				     ; di - start
2    98				     ; dl - width
2    99				     ; si - border source
2   100				     ; dh - height
2   101				     ; destroys	- dohuya
2   102				     ;
2   103
2   104	0161			     Border  proc
2   105	0161  55			     push bp
2   106	0162  8B EC			     mov bp, sp
2   107
2   108	0164  55			     push bp
2   109
2   110	0165  E8 0048			     call String
2   111
2   112	0168  81 C7 00A0		     add di, 80	* 2
2   113
2   114	016C  32 FF			     xor bh, bh
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 3
strlen.asm



2   115	016E  8A DA			     mov bl, dl
2   116
2   117	0170  2B FB			     sub di, bx
2   118	0172  2B FB			     sub di, bx
2   119
2   120	0174  8B EA			     mov bp, dx
2   121	0176  81 E5 FF00		     and bp, 0FF00h
2   122	017A  D1 ED D1 ED D1 ED	D1+	     shr bp, 8
    123	      ED D1 ED D1 ED D1	ED+
    124	      D1 ED
2   125	018A  83 ED 02			     sub bp, 2
2   126
2   127	018D  E8 0020		     zaloop: call String
2   128
2   129	0190  83 EE 03			     sub si, 3
2   130
2   131	0193  81 C7 00A0		     add di, 80	* 2
2   132
2   133	0197  32 FF			     xor bh, bh
2   134	0199  8A DA			     mov bl, dl
2   135
2   136	019B  2B FB			     sub di, bx
2   137	019D  2B FB			     sub di, bx
2   138
2   139	019F  4D			     dec bp
2   140
2   141	01A0  83 FD 00			     cmp bp, 0
2   142	01A3  75 E8			     jne zaloop
2   143
2   144	01A5  83 C6 03			     add si, 3
2   145
2   146	01A8  E8 0005			     call String
2   147
2   148	01AB  5D			     pop bp
2   149
2   150	01AC  8B E5			     mov sp, bp
2   151	01AE  5D			     pop bp
2   152	01AF  C3			     ret
2   153	01B0				     endp
2   154
2   155					     include string.asi
3   156				     ;
3   157				     ; args - ah, di, dl
3   158				     ; ah - attribute
3   159				     ; di - start
3   160				     ; dl - length
3   161				     ; destroys	- si, cx
3   162				     ;
3   163
3   164	01B0			     String  proc
3   165
3   166	01B0  AC			     lodsb
3   167	01B1  AB			     stosw
3   168
3   169	01B2  AC			     lodsb
3   170
3   171	01B3  8A CA			     mov cl, dl
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 4
strlen.asm



3   172	01B5  80 E9 02			     sub cl, 2
3   173	01B8  32 ED			     xor ch, ch
3   174
3   175	01BA  26: 89 05		     @@Next: mov es:[di], ax
3   176
3   177	01BD  83 C7 02			     add di, 2
3   178
3   179	01C0  E2 F8			     loop @@Next
3   180
3   181	01C2  AC			     lodsb
3   182	01C3  AB			     stosw
3   183
3   184	01C4  C3			     ret
3   185	01C5				     endp
1   186				     include text.asi
2   187	01C5			     Text    proc
2   188
2   189	01C5  BF 07D0			     mov di, 80	* 25
2   190
2   191	01C8  8B C2			     mov ax, dx
2   192	01CA  32 E4			     xor ah, ah		      ;	dl в общ
2   193
2   194	01CC  80 FE 00			     cmp dh, 0
2   195	01CF  75 03			     jne not_smol_txt1		  ; концептуально - сначала	идет    +
    196				     распечатка "больших" строк, а потом маленькой; ну и    +
    197				     здесь	джамп сразу к распечатке маленькой; важно не   +
    198				     проебать dl
2   199
2   200	01D1  E9 0179			     jmp smol_txt
2   201
2   202	01D4			     not_smol_txt1:
2   203
2   204	01D4  83 EF 0A			     sub di, word ptr 10
2   205
2   206	01D7  32 E4			     xor ah, ah
2   207	01D9  8A C6			     mov al, dh
2   208
2   209	01DB  B1 02			     mov cl, 2
2   210	01DD  F6 F1			     div cl
2   211
2   212					     REPT 160
2   213
2   214					     sub di, ax
2   215
2   216					     ENDM
3   217
3   218	01DF  2B F8			     sub di, ax
3   219
3   220
3   221	01E1  2B F8			     sub di, ax
3   222
3   223
3   224	01E3  2B F8			     sub di, ax
3   225
3   226
3   227	01E5  2B F8			     sub di, ax
3   228
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 5
strlen.asm



3   229
3   230	01E7  2B F8			     sub di, ax
3   231
3   232
3   233	01E9  2B F8			     sub di, ax
3   234
3   235
3   236	01EB  2B F8			     sub di, ax
3   237
3   238
3   239	01ED  2B F8			     sub di, ax
3   240
3   241
3   242	01EF  2B F8			     sub di, ax
3   243
3   244
3   245	01F1  2B F8			     sub di, ax
3   246
3   247
3   248	01F3  2B F8			     sub di, ax
3   249
3   250
3   251	01F5  2B F8			     sub di, ax
3   252
3   253
3   254	01F7  2B F8			     sub di, ax
3   255
3   256
3   257	01F9  2B F8			     sub di, ax
3   258
3   259
3   260	01FB  2B F8			     sub di, ax
3   261
3   262
3   263	01FD  2B F8			     sub di, ax
3   264
3   265
3   266	01FF  2B F8			     sub di, ax
3   267
3   268
3   269	0201  2B F8			     sub di, ax
3   270
3   271
3   272	0203  2B F8			     sub di, ax
3   273
3   274
3   275	0205  2B F8			     sub di, ax
3   276
3   277
3   278	0207  2B F8			     sub di, ax
3   279
3   280
3   281	0209  2B F8			     sub di, ax
3   282
3   283
3   284	020B  2B F8			     sub di, ax
3   285
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 6
strlen.asm



3   286
3   287	020D  2B F8			     sub di, ax
3   288
3   289
3   290	020F  2B F8			     sub di, ax
3   291
3   292
3   293	0211  2B F8			     sub di, ax
3   294
3   295
3   296	0213  2B F8			     sub di, ax
3   297
3   298
3   299	0215  2B F8			     sub di, ax
3   300
3   301
3   302	0217  2B F8			     sub di, ax
3   303
3   304
3   305	0219  2B F8			     sub di, ax
3   306
3   307
3   308	021B  2B F8			     sub di, ax
3   309
3   310
3   311	021D  2B F8			     sub di, ax
3   312
3   313
3   314	021F  2B F8			     sub di, ax
3   315
3   316
3   317	0221  2B F8			     sub di, ax
3   318
3   319
3   320	0223  2B F8			     sub di, ax
3   321
3   322
3   323	0225  2B F8			     sub di, ax
3   324
3   325
3   326	0227  2B F8			     sub di, ax
3   327
3   328
3   329	0229  2B F8			     sub di, ax
3   330
3   331
3   332	022B  2B F8			     sub di, ax
3   333
3   334
3   335	022D  2B F8			     sub di, ax
3   336
3   337
3   338	022F  2B F8			     sub di, ax
3   339
3   340
3   341	0231  2B F8			     sub di, ax
3   342
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 7
strlen.asm



3   343
3   344	0233  2B F8			     sub di, ax
3   345
3   346
3   347	0235  2B F8			     sub di, ax
3   348
3   349
3   350	0237  2B F8			     sub di, ax
3   351
3   352
3   353	0239  2B F8			     sub di, ax
3   354
3   355
3   356	023B  2B F8			     sub di, ax
3   357
3   358
3   359	023D  2B F8			     sub di, ax
3   360
3   361
3   362	023F  2B F8			     sub di, ax
3   363
3   364
3   365	0241  2B F8			     sub di, ax
3   366
3   367
3   368	0243  2B F8			     sub di, ax
3   369
3   370
3   371	0245  2B F8			     sub di, ax
3   372
3   373
3   374	0247  2B F8			     sub di, ax
3   375
3   376
3   377	0249  2B F8			     sub di, ax
3   378
3   379
3   380	024B  2B F8			     sub di, ax
3   381
3   382
3   383	024D  2B F8			     sub di, ax
3   384
3   385
3   386	024F  2B F8			     sub di, ax
3   387
3   388
3   389	0251  2B F8			     sub di, ax
3   390
3   391
3   392	0253  2B F8			     sub di, ax
3   393
3   394
3   395	0255  2B F8			     sub di, ax
3   396
3   397
3   398	0257  2B F8			     sub di, ax
3   399
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 8
strlen.asm



3   400
3   401	0259  2B F8			     sub di, ax
3   402
3   403
3   404	025B  2B F8			     sub di, ax
3   405
3   406
3   407	025D  2B F8			     sub di, ax
3   408
3   409
3   410	025F  2B F8			     sub di, ax
3   411
3   412
3   413	0261  2B F8			     sub di, ax
3   414
3   415
3   416	0263  2B F8			     sub di, ax
3   417
3   418
3   419	0265  2B F8			     sub di, ax
3   420
3   421
3   422	0267  2B F8			     sub di, ax
3   423
3   424
3   425	0269  2B F8			     sub di, ax
3   426
3   427
3   428	026B  2B F8			     sub di, ax
3   429
3   430
3   431	026D  2B F8			     sub di, ax
3   432
3   433
3   434	026F  2B F8			     sub di, ax
3   435
3   436
3   437	0271  2B F8			     sub di, ax
3   438
3   439
3   440	0273  2B F8			     sub di, ax
3   441
3   442
3   443	0275  2B F8			     sub di, ax
3   444
3   445
3   446	0277  2B F8			     sub di, ax
3   447
3   448
3   449	0279  2B F8			     sub di, ax
3   450
3   451
3   452	027B  2B F8			     sub di, ax
3   453
3   454
3   455	027D  2B F8			     sub di, ax
3   456
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 9
strlen.asm



3   457
3   458	027F  2B F8			     sub di, ax
3   459
3   460
3   461	0281  2B F8			     sub di, ax
3   462
3   463
3   464	0283  2B F8			     sub di, ax
3   465
3   466
3   467	0285  2B F8			     sub di, ax
3   468
3   469
3   470	0287  2B F8			     sub di, ax
3   471
3   472
3   473	0289  2B F8			     sub di, ax
3   474
3   475
3   476	028B  2B F8			     sub di, ax
3   477
3   478
3   479	028D  2B F8			     sub di, ax
3   480
3   481
3   482	028F  2B F8			     sub di, ax
3   483
3   484
3   485	0291  2B F8			     sub di, ax
3   486
3   487
3   488	0293  2B F8			     sub di, ax
3   489
3   490
3   491	0295  2B F8			     sub di, ax
3   492
3   493
3   494	0297  2B F8			     sub di, ax
3   495
3   496
3   497	0299  2B F8			     sub di, ax
3   498
3   499
3   500	029B  2B F8			     sub di, ax
3   501
3   502
3   503	029D  2B F8			     sub di, ax
3   504
3   505
3   506	029F  2B F8			     sub di, ax
3   507
3   508
3   509	02A1  2B F8			     sub di, ax
3   510
3   511
3   512	02A3  2B F8			     sub di, ax
3   513
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 10
strlen.asm



3   514
3   515	02A5  2B F8			     sub di, ax
3   516
3   517
3   518	02A7  2B F8			     sub di, ax
3   519
3   520
3   521	02A9  2B F8			     sub di, ax
3   522
3   523
3   524	02AB  2B F8			     sub di, ax
3   525
3   526
3   527	02AD  2B F8			     sub di, ax
3   528
3   529
3   530	02AF  2B F8			     sub di, ax
3   531
3   532
3   533	02B1  2B F8			     sub di, ax
3   534
3   535
3   536	02B3  2B F8			     sub di, ax
3   537
3   538
3   539	02B5  2B F8			     sub di, ax
3   540
3   541
3   542	02B7  2B F8			     sub di, ax
3   543
3   544
3   545	02B9  2B F8			     sub di, ax
3   546
3   547
3   548	02BB  2B F8			     sub di, ax
3   549
3   550
3   551	02BD  2B F8			     sub di, ax
3   552
3   553
3   554	02BF  2B F8			     sub di, ax
3   555
3   556
3   557	02C1  2B F8			     sub di, ax
3   558
3   559
3   560	02C3  2B F8			     sub di, ax
3   561
3   562
3   563	02C5  2B F8			     sub di, ax
3   564
3   565
3   566	02C7  2B F8			     sub di, ax
3   567
3   568
3   569	02C9  2B F8			     sub di, ax
3   570
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 11
strlen.asm



3   571
3   572	02CB  2B F8			     sub di, ax
3   573
3   574
3   575	02CD  2B F8			     sub di, ax
3   576
3   577
3   578	02CF  2B F8			     sub di, ax
3   579
3   580
3   581	02D1  2B F8			     sub di, ax
3   582
3   583
3   584	02D3  2B F8			     sub di, ax
3   585
3   586
3   587	02D5  2B F8			     sub di, ax
3   588
3   589
3   590	02D7  2B F8			     sub di, ax
3   591
3   592
3   593	02D9  2B F8			     sub di, ax
3   594
3   595
3   596	02DB  2B F8			     sub di, ax
3   597
3   598
3   599	02DD  2B F8			     sub di, ax
3   600
3   601
3   602	02DF  2B F8			     sub di, ax
3   603
3   604
3   605	02E1  2B F8			     sub di, ax
3   606
3   607
3   608	02E3  2B F8			     sub di, ax
3   609
3   610
3   611	02E5  2B F8			     sub di, ax
3   612
3   613
3   614	02E7  2B F8			     sub di, ax
3   615
3   616
3   617	02E9  2B F8			     sub di, ax
3   618
3   619
3   620	02EB  2B F8			     sub di, ax
3   621
3   622
3   623	02ED  2B F8			     sub di, ax
3   624
3   625
3   626	02EF  2B F8			     sub di, ax
3   627
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 12
strlen.asm



3   628
3   629	02F1  2B F8			     sub di, ax
3   630
3   631
3   632	02F3  2B F8			     sub di, ax
3   633
3   634
3   635	02F5  2B F8			     sub di, ax
3   636
3   637
3   638	02F7  2B F8			     sub di, ax
3   639
3   640
3   641	02F9  2B F8			     sub di, ax
3   642
3   643
3   644	02FB  2B F8			     sub di, ax
3   645
3   646
3   647	02FD  2B F8			     sub di, ax
3   648
3   649
3   650	02FF  2B F8			     sub di, ax
3   651
3   652
3   653	0301  2B F8			     sub di, ax
3   654
3   655
3   656	0303  2B F8			     sub di, ax
3   657
3   658
3   659	0305  2B F8			     sub di, ax
3   660
3   661
3   662	0307  2B F8			     sub di, ax
3   663
3   664
3   665	0309  2B F8			     sub di, ax
3   666
3   667
3   668	030B  2B F8			     sub di, ax
3   669
3   670
3   671	030D  2B F8			     sub di, ax
3   672
3   673
3   674	030F  2B F8			     sub di, ax
3   675
3   676
3   677	0311  2B F8			     sub di, ax
3   678
3   679
3   680	0313  2B F8			     sub di, ax
3   681
3   682
3   683	0315  2B F8			     sub di, ax
3   684
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 13
strlen.asm



3   685
3   686	0317  2B F8			     sub di, ax
3   687
3   688
3   689	0319  2B F8			     sub di, ax
3   690
3   691
3   692	031B  2B F8			     sub di, ax
3   693
3   694
3   695	031D  2B F8			     sub di, ax
3   696
2   697
2   698	031F  8A CE			     mov cl, dh
2   699	0321  32 ED			     xor ch, ch
2   700
2   701	0323  46			     inc si
2   702
2   703	0324			     @@Next:
2   704	0324  80 F9 00			     cmp cl, 0
2   705	0327  75 03			     jne not_smol_txt
2   706
2   707	0329  EB 22 90			     jmp smol_txt
2   708
2   709	032C			     not_smol_txt:
2   710
2   711	032C  B4 1E			     mov ah, 1Eh
2   712
2   713					     REPT 10
2   714
2   715					     lodsb
2   716					     stosw
2   717
2   718					     ENDM
3   719
3   720	032E  AC			     lodsb
3   721	032F  AB			     stosw
3   722
3   723
3   724	0330  AC			     lodsb
3   725	0331  AB			     stosw
3   726
3   727
3   728	0332  AC			     lodsb
3   729	0333  AB			     stosw
3   730
3   731
3   732	0334  AC			     lodsb
3   733	0335  AB			     stosw
3   734
3   735
3   736	0336  AC			     lodsb
3   737	0337  AB			     stosw
3   738
3   739
3   740	0338  AC			     lodsb
3   741	0339  AB			     stosw
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 14
strlen.asm



3   742
3   743
3   744	033A  AC			     lodsb
3   745	033B  AB			     stosw
3   746
3   747
3   748	033C  AC			     lodsb
3   749	033D  AB			     stosw
3   750
3   751
3   752	033E  AC			     lodsb
3   753	033F  AB			     stosw
3   754
3   755
3   756	0340  AC			     lodsb
3   757	0341  AB			     stosw
3   758
2   759
2   760	0342  FE C9			     dec cl
2   761	0344  81 C7 008C		     add di, (80 - 10) * 2
2   762
2   763	0348  EB DA			     jmp @@Next
2   764
2   765	034A  83 C7 05			     add di, 5
2   766
2   767	034D			     smol_txt:
2   768	034D  8A C2			     mov al, dl
2   769	034F  32 E4			     xor ah, ah
2   770
2   771	0351  2B F8			     sub di, ax
2   772
2   773	0353  8B CA			     mov cx, dx
2   774	0355  32 ED			     xor ch, ch
2   775	0357  49			     dec cx
2   776
2   777	0358  B4 1E			     mov ah, 1Eh
2   778
2   779	035A  83 E7 FE			     and di, 0FFFEh		     ; need even di
2   780
2   781	035D			     @@Next2:
2   782
2   783	035D  AC			     lodsb
2   784	035E  AB			     stosw
2   785
2   786	035F  83 F9 00			     cmp cx, 0
2   787	0362  74 02			     je	@@ret			     ; cause loop incs cx
2   788
2   789	0364  E2 F7			     loop @@Next2
2   790
2   791	0366  C3		     @@ret:  ret
2   792	0367				     endp
1   793
1   794
1   795
    796
    797	0367  44 45 44 45 20 45	44+  frame   db	'D', 'E', 'D', 'E', ' ', 'E', 'D', 'E',	'D'
    798	      45 44
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 15
strlen.asm



    799	0370  01 02 03 24	     jopa    db	1, 2, 3, '$'
    800	0374  02 00		     outl    db	2, 0
    801
    802				     end     Start
Turbo Assembler	 Version 4.1	    02/27/23 03:14:45	    Page 16
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/27/23"
??FILENAME			  Text	 "strlen  "
??TIME				  Text	 "03:14:45"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@NEXT				  Near	 DGROUP:0126
@@NEXT				  Near	 DGROUP:01BA
@@NEXT				  Near	 DGROUP:0324
@@NEXT2				  Near	 DGROUP:035D
@@RET				  Near	 DGROUP:0366
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 STRLEN
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BORDER				  Near	 DGROUP:0161
FOUT				  Near	 DGROUP:0130
FRAME				  Byte	 DGROUP:0367
JOPA				  Byte	 DGROUP:0370
NOT_SMOL_TXT			  Near	 DGROUP:032C
NOT_SMOL_TXT1			  Near	 DGROUP:01D4
OUTL				  Byte	 DGROUP:0374
SMOL_TXT			  Near	 DGROUP:034D
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:01B0
STRLEN				  Near	 DGROUP:011B
TEXT				  Near	 DGROUP:01C5
ZALOOP				  Near	 DGROUP:018D

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0376 Word	  Public  CODE

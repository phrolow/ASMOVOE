Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 1
border2.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     locals @@
      5
      6				     org 100h
      7
      8	0100  BE 0080		     Start:  mov si, 80h
      9
     10	0103  AC			     lodsb
     11
     12	0104  32 FF			     xor bh, bh
     13	0106  8A D8			     mov bl, al			     ; bl is length of our string
     14
     15	0108  46			     inc si
     16	0109  AC			     lodsb
     17
     18	010A  2C 30			     sub al, '0'
     19	010C  3C 00			     cmp al, 0
     20
     21	010E  75 0D			     jne ncbrd
     22
     23	0110  80 EB 09			     sub bl, 9			     ; length minus char of our	custom border
     24
     25	0113  BF 0277r			     mov di, offset cbrd
     26
     27	0116  B9 0009			     mov cx, 9
     28
     29	0119			     ReadCustom:
     30
     31	0119  AC			     lodsb
     32	011A  AA			     stosb
     33
     34	011B  E2 FC			     loop ReadCustom
     35
     36	011D  80 EB 01		     ncbrd:  sub bl, 1
     37
     38	0120  33 D2			     xor dx, dx			     ; wanna set height	and length
     39
     40	0122  8B C3			     mov ax, bx
     41	0124  B2 0A			     mov dl, 10			     ; 10 chars	in one line
     42
     43	0126  F6 F2			     div dl			     ; wanna know how many lines will be
     44	0128  B2 1E			     mov dl, 30
     45
     46	012A  8A F0			     mov dh, al
     47	012C  02 D2			     add dl, dl			     ; convert to vm px	(2 bytes)
     48
     49	012E  80 C6 05			     add dh, 5
     50
     51	0131  BF B800			     mov di, 0B800h
     52	0134  8E C7			     mov es, di
     53
     54	0136  BF 07D0			     mov di, 80	* 25
     55
     56	0139  33 C9			     xor cx, cx
     57	013B  8A CA			     mov cl, dl
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 2
border2.asm



     58
     59	013D  2B F9			     sub di, cx			     ; x of lt
     60
     61	013F  8A CE			     mov cl, dh
     62
     63	0141  8B E9			     mov bp, cx
     64
     65	0143  B9 00A0			     mov cx, word ptr 80 * 2
     66
     67	0146  2B FD		     lty:    sub di, bp			     ; y of lt
     68
     69	0148  E2 FC			     loop lty			     ; di to start
     70
     71	014A  80 C6 05			     add dh, 5
     72
     73	014D  BE 0082			     mov si, 82h
     74
     75	0150  8A 0C			     mov cl, byte ptr [si]
     76	0152  80 E9 30			     sub cl, '0'
     77	0155  32 ED			     xor ch, ch			     ; cl is type
     78
     79	0157  BE 0277r			     mov si, offset cbrd
     80
     81	015A  80 F9 00			     cmp cl, 0
     82	015D  74 08			     je	custom
     83
     84	015F  83 C6 0A		     @@next: add si, 10
     85	0162  E2 FB			     loop @@next
     86
     87	0164  AC			     lodsb
     88	0165  8A E0			     mov ah, al
     89
     90	0167			     custom:
     91
     92	0167  E8 0028			     call Border
     93
     94	016A  BE 0082			     mov si, 82h
     95
     96	016D  80 3C 30			     cmp byte ptr [si],	byte ptr '0'
     97
     98	0170  8A 0C			     mov cl, [si]
     99	0172  32 ED			     xor ch, ch
    100	0174  83 E9 30			     sub cx, '0'
    101
    102	0177  BB 0277r			     mov bx, offset cbrd
    103
    104	017A			     GetStyle:
    105
    106	017A  83 F9 00			     cmp cx, 0
    107	017D  74 06			     je	StyleGot
    108
    109	017F  83 C3 0A			     add bx, 10
    110	0182  49			     dec cx
    111
    112	0183  EB F5			     jmp GetStyle
    113
    114	0185			     StyleGot:
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 3
border2.asm



    115
    116	0185  8A 27			     mov ah, [bx]
    117	0187  83 C6 02			     add si, 2
    118
    119	018A  E8 0063			     call Text
    120
    121	018D  B8 4C00			     mov ax, 4C00h
    122	0190  CD 21			     int 21h
    123
    124					     include bordre.asi
1   125				     ;
1   126				     ; args - ah, di, dl, si
1   127				     ; ah - attribute
1   128				     ; di - start
1   129				     ; dl - width
1   130				     ; si - border source
1   131				     ; dh - height
1   132				     ; destroys	- dohuya
1   133				     ;
1   134
1   135	0192			     Border  proc
1   136	0192  55			     push bp
1   137
1   138	0193  E8 0045			     call String
1   139
1   140	0196  81 C7 00A0		     add di, 80	* 2
1   141
1   142	019A  32 FF			     xor bh, bh		     ; cringe
1   143	019C  8A DA			     mov bl, dl
1   144
1   145	019E  2B FB			     sub di, bx
1   146	01A0  2B FB			     sub di, bx
1   147
1   148	01A2  8B EA			     mov bp, dx
1   149	01A4  81 E5 FF00		     and bp, 0FF00h
1   150	01A8  D1 ED D1 ED D1 ED	D1+	     shr bp, 8
    151	      ED D1 ED D1 ED D1	ED+
    152	      D1 ED
1   153	01B8  83 ED 02			     sub bp, 2
1   154
1   155	01BB  E8 001D		     zaloop: call String
1   156
1   157	01BE  83 EE 03			     sub si, 3
1   158
1   159	01C1  81 C7 00A0		     add di, 80	* 2
1   160
1   161	01C5  32 FF			     xor bh, bh		     ; cringe
1   162	01C7  8A DA			     mov bl, dl
1   163
1   164	01C9  2B FB			     sub di, bx
1   165	01CB  2B FB			     sub di, bx
1   166
1   167	01CD  4D			     dec bp
1   168
1   169	01CE  83 FD 00			     cmp bp, 0
1   170	01D1  75 E8			     jne zaloop
1   171
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 4
border2.asm



1   172	01D3  83 C6 03			     add si, 3
1   173
1   174	01D6  E8 0002			     call String
1   175
1   176	01D9  5D			     pop bp
1   177	01DA  C3			     ret
1   178	01DB				     endp
1   179
1   180					     include string.asi
2   181				     ;
2   182				     ; args - ah, di, dl
2   183				     ; ah - attribute
2   184				     ; di - start
2   185				     ; dl - length
2   186				     ; destroys	- si, cx
2   187				     ;
2   188
2   189	01DB			     String  proc
2   190
2   191	01DB  AC			     lodsb
2   192	01DC  AB			     stosw
2   193
2   194	01DD  AC			     lodsb
2   195
2   196	01DE  8A CA			     mov cl, dl
2   197	01E0  80 E9 02			     sub cl, 2
2   198	01E3  32 ED			     xor ch, ch
2   199
2   200	01E5  26: 89 05		     @@Next: mov es:[di], ax
2   201
2   202	01E8  83 C7 02			     add di, 2
2   203
2   204	01EB  E2 F8			     loop @@Next
2   205
2   206	01ED  AC			     lodsb
2   207	01EE  AB			     stosw
2   208
2   209	01EF  C3			     ret
2   210	01F0				     endp
    211					     include text2.asi
1   212				     ; pls si, ah
1   213
1   214	01F0			     text	 proc
1   215	01F0  50 56				 push ax si
1   216
1   217	01F2  8C CF				 mov di, cs
1   218	01F4  8E C7				 mov es, di
1   219	01F6  BF 026Dr				 mov di, offset	Lines
1   220
1   221				     ;NewLine:	  xor cx, cx
1   222
1   223				     ;Reading:	  lodsb
1   224				     ;		  cmp al, 0Dh
1   225				     ;		  je EndOfReading
1   226
1   227				     ;		  cmp al, 2
1   228				     ;		  je NewLine
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 5
border2.asm



1   229
1   230				     ;		  inc cx
1   231				     ;		  cmp cx, 10
1   232				     ;		  jne Reading
1   233
1   234				     ;AddLine:
1   235				     ;		  mov al, cl
1   236				     ;		  stosb
1   237
1   238				     ;		  jmp NewLine
1   239
1   240	01F9  33 C9				 xor cx, cx
1   241
1   242	01FB  41		     NextChar:	 inc cx
1   243
1   244	01FC  AC				 lodsb
1   245
1   246	01FD  3C 02				 cmp al, 2
1   247	01FF  74 06				 je NewLine
1   248
1   249	0201  3C 0D				 cmp al, 0Dh
1   250	0203  74 02				 je NewLine
1   251
1   252	0205  EB F4				 jmp NextChar
1   253
1   254	0207  FE C9		     NewLine:	 dec cl
1   255	0209  88 0D				 mov [di], cl
1   256	020B  47				 inc di
1   257	020C  32 ED				 xor ch, ch
1   258
1   259	020E  3C 0D				 cmp al, 0Dh
1   260	0210  75 E9				 jne NextChar
1   261
1   262	0212  8A C1				 mov al, cl
1   263	0214  AA				 stosb				 ; filled array	of lengths
1   264
1   265	0215  BE 026Dr				 mov si, offset	Lines
1   266	0218  B9 000A				 mov cx, 10
1   267
1   268	021B  33 D2				 xor dx, dx
1   269
1   270	021D  AC		     CountLines: lodsb
1   271
1   272	021E  FE C6				 inc dh
1   273
1   274	0220  3C 00				 cmp al, 0
1   275	0222  E0 F9				 loopne	CountLines
1   276
1   277	0224  FE CE				 dec dh
1   278
1   279	0226  32 E4				 xor ah, ah
1   280	0228  8A C6				 mov al, dh
1   281
1   282	022A  32 ED				 xor ch, ch
1   283	022C  B1 02				 mov cl, 2
1   284
1   285	022E  F6 F1				 div cl
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 6
border2.asm



1   286
1   287	0230  BF B800				 mov di, 0B800h
1   288	0233  8E C7				 mov es, di
1   289	0235  BF 07D0				 mov di, 80 * 25		 ; mid of screen
1   290
1   291	0238  8A C8				 mov cl, al
1   292
1   293	023A  80 F9 00				 cmp cl, 0
1   294	023D  74 06				 je DontUp
1   295
1   296	023F  81 EF 00A0	     Up:	 sub di, 80 * 2
1   297
1   298	0243  E2 FA				 loop Up
1   299
1   300	0245  8A CE		     DontUp:	 mov cl, dh
1   301
1   302	0247  BB 026Dr				 mov bx, offset	Lines
1   303
1   304	024A  5E 58				 pop si	ax
1   305
1   306	024C  8B 17		     WriteLine:	 mov dx, [bx]
1   307
1   308	024E  2B FA				 sub di, dx
1   309	0250  83 E7 FE				 and di, 0FFFEh			 ; line	must be	in mid
1   310
1   311	0253  51				 push cx
1   312
1   313	0254  8B CA				 mov cx, dx
1   314
1   315	0256  AC		     WriteChar:	 lodsb
1   316	0257  AB				 stosw
1   317
1   318	0258  E2 FC				 loop WriteChar
1   319
1   320	025A  59				 pop cx
1   321
1   322	025B  2B FA				 sub di, dx
1   323
1   324	025D  83 E2 01				 and dx, 01h
1   325	0260  83 FA 01				 cmp dx, 1
1   326	0263  75 05				 jne @@even
1   327
1   328	0265  4F				 dec di
1   329	0266  4B				 dec bx
1   330
1   331	0267  83 C7 50				 add di, 80
1   332
1   333	026A  E2 E0		     @@even:	 loop WriteLine
1   334
1   335	026C  C3				 ret
1   336	026D					 endp
1   337
1   338	026D  0A*(00)		     Lines	 db 10 dup(0)
    339
    340	0277  ?? ?? ?? ?? ?? ??	??+  cbrd    db	   ?,	 ?,    ?,    ?,	   ?,	 ?,    ?,    ?,	   ?,	 ?  ; custom border
    341	      ?? ?? ??
    342	0281  1F C9 CD BB BA 00	BA+  brd1    db	01Fh, 0C9h, 0CDh, 0BBh,	0BAh, 000h, 0BAh, 0C8h,	0CDh, 0BCh
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 7
border2.asm



    343	      C8 CD BC
    344	028B  71 80 80 80 80 00	80+  brd2    db	071h, 080h, 080h, 080h,	080h, 000h, 080h, 080h,	080h, 080h
    345	      80 80 80
    346	0295  22 1E 1E 1E 1E 00	1E+  brd3    db	022h, 01Eh, 01Eh, 01Eh,	01Eh, 000h, 01Eh, 01Eh,	01Eh, 01Eh
    347	      1E 1E 1E
    348	029F  1E 40 40 40 40 00	40+  brd4    db	01Eh, 040h, 040h, 040h,	040h, 000h, 040h, 040h,	040h, 040h
    349	      40 40 40
    350	02A9  CE 40 40 40 40 00	40+  brd5    db	0CEh, 040h, 040h, 040h,	040h, 000h, 040h, 040h,	040h, 040h
    351	      40 40 40
    352
    353				     end     Start
Turbo Assembler	 Version 4.1	    03/04/23 05:30:08	    Page 8
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/04/23"
??FILENAME			  Text	 "border2 "
??TIME				  Text	 "05:30:08"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@EVEN				  Near	 DGROUP:026A
@@NEXT				  Near	 DGROUP:015F
@@NEXT				  Near	 DGROUP:01E5
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 BORDER2
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BORDER				  Near	 DGROUP:0192
BRD1				  Byte	 DGROUP:0281
BRD2				  Byte	 DGROUP:028B
BRD3				  Byte	 DGROUP:0295
BRD4				  Byte	 DGROUP:029F
BRD5				  Byte	 DGROUP:02A9
CBRD				  Byte	 DGROUP:0277
COUNTLINES			  Near	 DGROUP:021D
CUSTOM				  Near	 DGROUP:0167
DONTUP				  Near	 DGROUP:0245
GETSTYLE			  Near	 DGROUP:017A
LINES				  Byte	 DGROUP:026D
LTY				  Near	 DGROUP:0146
NCBRD				  Near	 DGROUP:011D
NEWLINE				  Near	 DGROUP:0207
NEXTCHAR			  Near	 DGROUP:01FB
READCUSTOM			  Near	 DGROUP:0119
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:01DB
STYLEGOT			  Near	 DGROUP:0185
TEXT				  Near	 DGROUP:01F0
UP				  Near	 DGROUP:023F
WRITECHAR			  Near	 DGROUP:0256
WRITELINE			  Near	 DGROUP:024C
ZALOOP				  Near	 DGROUP:01BB

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  02B3 Word	  Public  CODE
